import{jsxs as C}from"react/jsx-runtime";import"node:stream";import{s as m,a as v,t as J,g as E,b as P,c as O,d as H,R as D}from"./ssr-BLrUNRXs.js";import{isPlainObject as U,defaultStringifySearch as q,isRedirect as R,isNotFound as j,defaultParseSearch as L,useRouter as k}from"@tanstack/react-router";import b from"tiny-invariant";import{eventHandler as A}from"h3";import*as N from"fs";import"unctx";import"node:async_hooks";import"react";import"jsesc";import"isbot";import"react-dom/server";import"@tanstack/react-cross-context";import"react-dom";function _(e,r){const t=r;return b(t.url,"createServerFn must be called with a function that is marked with the 'use server' pragma. Are you using the @tanstack/router-plugin/vite ?"),Object.assign(async(s,o)=>t({method:e,payload:s||void 0,requestInit:o?.requestInit}),{url:r.url})}async function G(e,r,t){var s,o;const d=r[0];if(U(d)&&d.method){const n=d,a=n.payload instanceof FormData?"formData":n.payload instanceof Request?"request":"payload",i=new Headers({[m]:a,...a==="payload"?{"content-type":"application/json",accept:"application/json"}:{},...((s=n.requestInit)==null?void 0:s.headers)instanceof Headers?Object.fromEntries(n.requestInit.headers.entries()):((o=n.requestInit)==null?void 0:o.headers)||{}});if(n.method==="GET"){const f=n.payload!==void 0?q({payload:n.payload}).substring(1):"";f&&(e+=`&${f}`)}const w=new Request(e,{...n.requestInit,method:n.method,headers:i,...n.method==="POST"?{body:a==="formData"?n.payload:JSON.stringify(n.payload??null)}:{}}),y=await t(w),h=await S(y);if(["rsc"].includes(h.headers.get(v)))return h.body;if(["json"].includes(h.headers.get(v))){const f=await h.text(),g=f?JSON.parse(f):void 0;if(R(g)||j(g))throw g;return g}return h}const c=new Request(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",[m]:"args"},body:JSON.stringify(r)}),u=await S(await t(c)),l=u.headers.get("content-type"),p=await u.text();return l&&l.includes("application/json")?p?JSON.parse(p):void 0:p}async function S(e){if(!e.ok){const r=e.headers.get("content-type"),t=r&&r.includes("application/json"),s=await(async()=>t?await e.json():await e.text())(),o=`Request failed with status ${e.status}`;throw t?new Error(JSON.stringify({message:o,body:s})):new Error([o,`${JSON.stringify(s,null,2)}`].join(`

`))}return e}function B(e,r,t){return`${e}/_server/?_serverFnId=${encodeURI(r)}&_serverFnName=${encodeURI(t)}`}A(M);async function M(e){return I(J(e))}async function I(e,r){var t,s;const o=e.method,d=new URL(e.url,"http://localhost:3000"),c=Object.fromEntries(new URLSearchParams(d.search).entries()),u=c._serverFnId,l=c._serverFnName;if(!u||!l)throw new Error("Invalid request");b(typeof u=="string","Invalid server action");const p=(s=await((t=E("server").chunks[u])==null?void 0:t.import()))==null?void 0:s[l],n=await(async()=>{try{const a=await(async()=>{var w;return e.headers.get(m)==="payload"?[o.toLowerCase()==="get"?(()=>{var y;return(y=L(d.search))==null?void 0:y.payload})():await e.json(),{method:o,request:e}]:e.headers.get(m)==="formData"||(w=e.headers.get("Content-Type"))!=null&&w.includes("multipart/form-data")?[o.toLowerCase()==="get"?(()=>{const{_serverFnId:y,_serverFnName:h,payload:f}=c;return f})():await e.formData(),{method:o,request:e}]:e.headers.get(m)==="request"?[e,{method:o,request:e}]:await e.json()})(),i=await p(...a);return i instanceof Response?i:R(i)||j(i)?F(i):new Response(i!==void 0?JSON.stringify(i):void 0,{status:P(O()),headers:{"Content-Type":"application/json",[v]:"json"}})}catch(a){return a instanceof Response?a:R(a)||j(a)?F(a):(console.error("Server Fn Error!"),console.error(a),console.info(),new Response(JSON.stringify(a),{status:500,headers:{"Content-Type":"application/json",[v]:"error"}}))}})();if(n.headers.get("Content-Type")==="application/json"){const i=await n.clone().text();i&&JSON.stringify(JSON.parse(i))}return n}function F(e){const{headers:r,...t}=e;return new Response(JSON.stringify(t),{status:200,headers:{"Content-Type":"application/json",[v]:"json",...e.headers||{}}})}function T(e,r,t){const s=B("http://localhost:3000",r,t);return Object.assign((...d)=>G(s,d,async c=>{const u=O(),l=H(u);return Object.entries(l).forEach(([p,n])=>{c.headers.has(p)||c.headers.append(p,n)}),I(c)}),{url:s})}const $="count.txt";async function x(){return parseInt(await N.promises.readFile($,"utf-8").catch(()=>"0"))}const W=_("GET",T(K,"c_1wfb23","$$function0")),z=_("POST",T(Q,"c_1wfb23","$$function1")),ue=function(){const r=k(),t=D.useLoaderData();return C("button",{onClick:()=>{z(1).then(()=>{r.invalidate()})},children:["Add 1 to ",t,"?"]})},pe=async()=>await W();function K(){return x()}async function Q(e){const r=await x();await N.promises.writeFile($,`${r+e}`)}export{K as $$function0,Q as $$function1,ue as component,pe as loader};
